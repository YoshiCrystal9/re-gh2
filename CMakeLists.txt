# gh2test - ReXGlue Recompiled Project
# Generated by: rexglue init
#
# This file is SDK-managed. Running 'rexglue migrate' will overwrite it.

cmake_minimum_required(VERSION 3.25)
project(gh2test LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

if(NOT MSVC)
    add_compile_options(-msse4.1)
endif()

set(REXSDK_DIR "thirdparty/rexglue-sdk")
set(REXSDK_DIR "" CACHE PATH "Path to rexglue-sdk source tree")
if(REXSDK_DIR)
    add_subdirectory("${REXSDK_DIR}" rexglue-sdk)
else()
    find_package(rexglue QUIET CONFIG)
    if(NOT rexglue_FOUND)
        message(FATAL_ERROR
            "ReXGlue SDK not found. Either:\n"
            "  - Set REXSDK_DIR to the rexglue-sdk source tree (e.g. thirdparty/rexglue-sdk)\n"
            "  - Install the SDK package and ensure it is on CMAKE_PREFIX_PATH")
    endif()
endif()

# Sources
set(GH2TEST_SOURCES
    src/main.cpp
    src/arkless.cpp
)

# Include generated code if codegen has been run
if(EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/generated/sources.cmake")
    include(generated/sources.cmake)
    list(APPEND GH2TEST_SOURCES ${GENERATED_SOURCES})
endif()

if(WIN32)
    add_executable(gh2test WIN32 ${GH2TEST_SOURCES})
else()
    add_executable(gh2test ${GH2TEST_SOURCES})
endif()

target_include_directories(gh2test PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/generated
)

target_link_libraries(gh2test PRIVATE
    rex::core
    rex::system
    rex::kernel
    rex::graphics
    rex::ui
)

# Platform entry point, ReXApp source, and platform-specific settings
rexglue_configure_target(gh2test)

# Codegen target - run 'cmake --build . --target gh2test_codegen'
add_custom_target(gh2test_codegen
    COMMAND $<TARGET_FILE:rex::rexglue> codegen ${CMAKE_CURRENT_SOURCE_DIR}/gh2test_config.toml
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    COMMENT "Generating recompiled code for gh2test"
    VERBATIM
)
